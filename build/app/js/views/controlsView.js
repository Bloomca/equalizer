/*! Created at 07-12-2014 */
define(["jquery","underscore","backbone","settings","jqueryui"],function(a,b,c,d){var e=c.View.extend({el:a("#control-panel"),initialize:function(){function b(a){return Math.floor(a/60)+":"+(a%60>10?Math.floor(a%60):"0"+Math.floor(a%60))}this.render(),a('<div class="slider">').slider({step:.1,max:1,min:0,value:1,slide:function(a,b){d.volume.gain.value=b.value}}).appendTo(this.$("#volume"));var c,e,f=this,g=this.$("#progress"),h=g.find("div"),i=this.$("#duration"),j=!1;this.$duration=i,d.on("change:duration",function(){clearInterval(c);var a=d.duration,g=Date.now(),k=b(a),l=50,m=0;c=setInterval(function(){if(j)return void(g+=l);if(!d.view.audio)return i.html(""),void clearInterval(c);void 0!==e&&(m=a*e*1e3-Date.now()+g,d.view.audio.currentTime=a*e,e=void 0);var n=(Date.now()-g+m)/(10*a);n>=100?(clearInterval(c),h.css({width:"100%"}),i.html(k+" / "+k),m=0,f.playNext()):(h.css({width:n+"%"}),i.html(b(a*n/100)+" / "+k))},l)}),d.on("rewind",function(a){e=a}),d.on("play:pause",function(){j=!0}),d.on("play:resume",function(){j=!1}),d.on("start:app",function(){f.$el.fadeIn(1500)})},events:{"click .prev":"playPrevious","click .next":"playNext","click .play":"togglePlay","click #progress":"rewind","click .stop":"stop","click .volume":"toggleVolume"},template:b.template(a("#control-panel-tmpl").html()),render:function(){this.$el.html(this.template())},playPrevious:function(){d.view&&d.view.audio.currentTime>10?d.trigger("rewind",0):this.collection.trigger("play:prev"),d.trigger("play:resume")},playNext:function(){this.collection.trigger("play:next"),d.trigger("play:resume")},togglePlay:function(){d.view.$(".play").click()},rewind:function(b){d.trigger("rewind",b.offsetX/a(b.target).width())},stop:function(){d.trigger("rewind",0),d.view.trigger("stop")},toggleVolume:function(){this.oldVolume?(this.$(".volume").attr("src","img/sound-on.jpg"),d.volume.gain.value=this.oldVolume,this.oldVolume=void 0,a(".slider").slider("option","disabled",!1)):(this.$(".volume").attr("src","img/sound-off.jpg"),this.oldVolume=d.volume.gain.value,d.volume.gain.value=0,this.$(".slider").slider("option","disabled",!0))}});return e});